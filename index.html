<!DOCTYPE html>

<html>
  <head>
    <link rel="stylesheet" href="index.css" />
    <title>Bobby's Narrative Visualization</title>
  </head>

  <body>
    <h1 style="text-align: center">
      Number of Tuition Covered Classes for each Department
    </h1>
    <p style="text-align: center">
      Here is a list government departments that have classes available for
      employees, with the tuition covered by the government. Please click on a
      bar to see the list of available schools!
    </p>
    <p style="text-align: center">
      As you can see there are thousands of classes for government employees to
      further their education and this is only for the employees in the Maryland
      area!
    </p>
    <svg></svg>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
      d3.csv("data.csv").then(function (data) {
        console.log(data);

        let departmentCount = {};
        for (let i = 0; i < data.length; i++) {
          let department = data[i].Department;

          if (departmentCount[department]) {
            departmentCount[department] += 1;
          } else {
            departmentCount[department] = 1;
          }
        }
        console.log(departmentCount);

        let to_loop = [];

        for (const dept in departmentCount) {
          if (departmentCount[dept] >= 55) {
            to_loop.push({ name: dept, value: departmentCount[dept] });
          }
        }

        function sorting(one, two) {
          return two.value - one.value;
        }

        to_loop.sort(sorting);

        console.log(to_loop);

        let width = window.innerWidth - 150;
        let height = window.innerHeight - 120;

        let svg = d3
          .select("svg")
          .attr("width", width + 150)
          .attr("height", height + 120);

        let departmentNames = [];
        for (let i = 0; i < to_loop.length; i++) {
          departmentNames.push(to_loop[i].name);
        }

        let x = d3
          .scaleBand()
          .range([0, width])
          .domain(departmentNames)
          .padding(0.15);

        let y = d3.scaleLinear().range([height, 0]).domain([0, 1377]);

        let g = svg
          .append("g")
          .attr("transform", "translate(" + 50 + "," + 20 + ")");

        g.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        g.append("g").call(d3.axisLeft(y));

        g.selectAll(".bar")
          .data(to_loop)
          .enter()
          .append("rect")
          .attr("class", "chart")
          .attr("x", function (f) {
            return x(f.name);
          })
          .attr("y", function (f) {
            return y(f.value);
          })
          .attr("height", function (f) {
            return height - y(f.value);
          })
          .attr("width", x.bandwidth())

          .on("click", function (event, f) {
            let url = `schools.html?name=${encodeURIComponent(f.name)}`;
            window.location.href = url;
          });

        g.append("text")
          .attr("transform", `translate(${width / 2 + 20}, ${height + 80})`)
          .text("Department");
      });
    </script>
  </body>
</html>
